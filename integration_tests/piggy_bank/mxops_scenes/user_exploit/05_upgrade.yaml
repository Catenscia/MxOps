allowed_networks:
  - localnet
  - testnet
  - devnet
  - chain-simulator

allowed_scenario:
  - "integration_test_piggy_bank_user_exploit"

steps:
  - type: ContractUpgrade
    sender: jean
    wasm_path: "./integration_tests/piggy_bank/contracts/esdt-minter/output/esdt-minter.wasm"
    abi_path: "./integration_tests/piggy_bank/contracts/esdt-minter/output/esdt-minter.abi.json"
    contract: "abc-esdt-minter"
    gas_limit: 50000000
    arguments:
      - 200
    upgradeable: true
    readable: false
    payable: false
    payable_by_sc: true

  - type: ContractCall
    sender: thomas
    contract: "abc-piggy-bank"
    endpoint: deposit
    esdt_transfers:
      - identifier: "%abc-esdt-minter.EsdtIdentifier"
        amount: 100000
        nonce: 0
    gas_limit: 8000000

  - type: ContractCall
    sender: thomas
    contract: "abc-piggy-bank"
    endpoint: withdraw
    gas_limit: 8000000
    checks:
      - type: Success

      - type: Transfers
        condition: included
        expected_transfers:
          - sender: "%abc-piggy-bank.address"
            receiver: "%thomas.address"
            identifier: "%abc-esdt-minter.EsdtIdentifier"
            amount: 300000
